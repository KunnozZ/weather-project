<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Forecast - Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@200;300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Prompt', sans-serif; background: #020617; color: white; background-image: url('https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?q=80&w=2000'); background-size: cover; background-attachment: fixed; }
        .glass { background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); transition: 0.4s ease; }
        .glass:hover { border: 1px solid rgba(59, 130, 246, 0.5); box-shadow: 0 0 25px rgba(59, 130, 246, 0.15); }
        main { animation: fadeInUp 0.8s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏¥‡πã‡∏ß */
        .btn-mini { font-size: 0.75rem; padding: 5px 12px; border-radius: 99px; transition: 0.3s; border: 1px solid rgba(255,255,255,0.1); background: rgba(0,0,0,0.4); cursor: pointer; }
        .btn-mini:hover { transform: translateY(-2px); box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); background: #2563eb; }
        
        /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Active) */
        .active-layer { background: #2563eb !important; border-color: #60a5fa !important; box-shadow: 0 0 15px rgba(37, 99, 235, 0.6) !important; color: white !important; }
        .active-mode { background: #2563eb !important; color: white !important; }
        
        .theme-btn { position: absolute; top: 12px; right: 12px; z-index: 1000; font-size: 0.65rem; background: rgba(0,0,0,0.7); border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 8px; transition: 0.3s; cursor: pointer; }
        .theme-btn:hover { background: white; color: black; }
        
        #chat-messages::-webkit-scrollbar { width: 4px; }
        #chat-messages::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 10px; }
        .typing { font-style: italic; opacity: 0.7; font-size: 10px; }
    </style>
</head>
<body class="min-h-screen">
    <nav class="glass sticky top-0 z-[2000] flex justify-between items-center px-10 py-5">
        <div class="text-2xl font-bold italic text-blue-400">Weather Forecast</div>
        <div class="hidden md:flex space-x-8 items-center" id="navbar-links">
            <a href="index.html" class="text-blue-400 border-b-2 border-blue-400 pb-1">Homepage</a>
            <a href="guide.html" class="hover:text-blue-400 transition">Guide</a>
            <a href="map.html" class="hover:text-blue-400 transition">Map</a>
            <a href="signin.html" class="hover:text-blue-400 transition" id="login-nav-link">Sign in</a>
            <a href="about.html" class="hover:text-blue-400 transition">About me</a>
        </div>
    </nav>

    <main class="container mx-auto p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        <!-- Sidebar: Info -->
        <div class="lg:col-span-4 space-y-6">
            <div class="glass p-3 rounded-2xl flex items-center group">
                <i class="fas fa-search mx-3 text-blue-400 group-hover:scale-110 transition"></i>
                <input type="text" id="cityInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á..." class="bg-transparent border-none outline-none w-full text-white text-sm" onkeypress="if(event.key === 'Enter') getWeather()">
                <button onclick="getLocation()" class="text-blue-400 px-2 hover:rotate-90 transition duration-500"><i class="fas fa-location-crosshairs text-lg"></i></button>
            </div>
            <div class="glass p-8 rounded-[2.5rem] text-center relative overflow-hidden">
                <div id="loading" class="hidden absolute inset-0 bg-black/60 flex items-center justify-center z-10 backdrop-blur-sm italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
                <h2 id="cityName" class="text-xl mb-1 font-semibold text-blue-100 uppercase tracking-widest">‡∏£‡∏∞‡∏ö‡∏∏‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</h2>
                <div id="mainTemp" class="text-8xl font-light my-4 tracking-tighter text-white drop-shadow-lg">--¬∞C</div>
                <p id="description" class="text-blue-300 text-sm italic font-light">‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                <div class="mt-8 text-left space-y-4 border-t border-white/5 pt-6 text-xs">
                    <div class="flex items-center justify-between"><span class="text-gray-400">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</span><span id="tempDetail" class="font-bold">--</span></div>
                    <div class="flex items-center justify-between"><span class="text-gray-400">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</span><span id="humidity" class="font-bold">--</span></div>
                    <div class="flex items-center justify-between"><span class="text-gray-400">‡∏•‡∏°</span><span id="wind" class="font-bold">--</span></div>
                </div>
            </div>
        </div>

        <!-- Main Panel -->
        <div class="lg:col-span-8 space-y-6">
            <div class="glass p-6 rounded-[2.5rem] h-[620px] flex flex-col relative shadow-2xl">
                <div class="flex gap-2 mb-4">
                    <button onclick="switchTab('map')" id="btn-mode-map" class="btn-mini active-mode font-semibold">‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</button>
                    <button onclick="switchTab('chat')" id="btn-mode-chat" class="btn-mini bg-slate-800 font-semibold">ChatBot AI</button>
                </div>

                <!-- Tab Map -->
                <div id="tab-map" class="flex-grow flex flex-col gap-3">
                    <div class="flex-grow rounded-3xl overflow-hidden relative border border-white/5 shadow-inner">
                        <div class="absolute top-3 left-1/2 -translate-x-1/2 z-[1000] flex gap-1.5 p-1 bg-black/60 rounded-full backdrop-blur-md">
                            <button onclick="toggleWeatherLayer('precipitation_new', this)" class="btn-weather-layer btn-mini">‡∏ù‡∏ô</button>
                            <button onclick="toggleWeatherLayer('clouds_new', this)" class="btn-weather-layer btn-mini">‡πÄ‡∏°‡∏Ü</button>
                            <button onclick="toggleWeatherLayer('temp_new', this)" class="btn-weather-layer btn-mini">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</button>
                            <button onclick="toggleWeatherLayer('wind_new', this)" class="btn-weather-layer btn-mini">‡∏•‡∏°</button>
                        </div>
                        <button onclick="toggleMapTheme()" id="themeBtn" class="theme-btn"><i class="fas fa-moon"></i> Dark Mode</button>
                        <div id="map" class="h-full w-full"></div>
                    </div>
                    <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (‡∏î‡∏∂‡∏á‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß) -->
                    <div id="map-description" class="hidden bg-blue-500/10 p-3 rounded-xl border border-blue-500/20 text-[11px] text-blue-100 italic">
                        <i class="fas fa-info-circle mr-2"></i><span id="desc-text"></span>
                    </div>
                </div>

                <!-- Tab Chat -->
                <div id="tab-chat" class="hidden flex-grow flex flex-col overflow-hidden">
                    <div id="chat-messages" class="flex-grow overflow-y-auto p-4 space-y-4 flex flex-col rounded-xl mb-4 bg-black/20">
                        <div class="p-3 bg-white/10 rounded-2xl rounded-tl-none max-w-[85%] text-xs">AI: ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ú‡∏°‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ ‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏•‡∏ü‡πå‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</div>
                    </div>
                    <div class="flex flex-wrap gap-1.5 mb-3 px-1">
                        <button onclick="quickChat('‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á')" class="btn-mini text-[10px]">üå§ ‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</button>
                        <button onclick="quickChat('‡∏Ñ‡∏ß‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏î‡∏µ')" class="btn-mini text-[10px]">üëï ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß</button>
                        <button onclick="quickChat('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°')" class="btn-mini text-[10px]">üöó ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ</button>
                        <button onclick="quickChat('‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏î‡∏µ‡πÑ‡∏´‡∏°')" class="btn-mini text-[10px]">üß∫ ‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤</button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chatInput" placeholder="‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö AI..." class="flex-grow bg-white/5 border border-white/10 p-3 rounded-xl outline-none text-xs focus:border-blue-500" onkeypress="if(event.key === 'Enter') sendChat()">
                        <button onclick="sendChat()" class="bg-blue-600 px-6 rounded-xl hover:scale-105 transition"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const API_KEY = '0a88acd34adcdee79f60f221f82d2331'; 
        let map = L.map('map').setView([13.75, 100.5], 6);
        let weatherLayer = null, currentLayerType = null, isDarkMode = false, currentWeatherData = null;
        const lightTiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
        const darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
        lightTiles.addTo(map);

        // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        const layerDescs = {
            'precipitation_new': '<b>‡πÇ‡∏´‡∏°‡∏î‡∏ù‡∏ô‡∏ï‡∏Å:</b> ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏ù‡∏ô‡∏™‡∏∞‡∏™‡∏°‡πÉ‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô/‡∏°‡πà‡∏ß‡∏á‡∏Ñ‡∏∑‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ù‡∏ô',
            'clouds_new': '<b>‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏Ü:</b> ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏°‡∏Ü ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏≠‡πÄ‡∏°‡∏Ü‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô',
            'temp_new': '<b>‡πÇ‡∏´‡∏°‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥:</b> ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô ‡∏™‡∏µ‡∏™‡πâ‡∏°/‡πÅ‡∏î‡∏á‡∏Ñ‡∏∑‡∏≠‡∏£‡πâ‡∏≠‡∏ô ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡πá‡∏ô',
            'wind_new': '<b>‡πÇ‡∏´‡∏°‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏£‡∏á‡∏•‡∏°:</b> ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡πÅ‡∏•‡∏∞‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏•‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÇ‡∏•‡∏Å'
        };

        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const userName = localStorage.getItem('userName') || 'User';
            const navMenu = document.getElementById('navbar-links');
            const signInLink = document.getElementById('login-nav-link');
            if (isLoggedIn === 'true' && signInLink) {
                signInLink.innerHTML = `<i class="fas fa-user-circle mr-1"></i>${userName}`;
                signInLink.href = "#"; signInLink.classList.remove('text-blue-400', 'border-b-2');
                const logoutBtn = document.createElement('a');
                logoutBtn.innerHTML = `Logout`;
                logoutBtn.className = "hover:text-red-400 cursor-pointer transition text-[10px] opacity-60 ml-4";
                logoutBtn.onclick = function() { localStorage.clear(); window.location.reload(); };
                navMenu.appendChild(logoutBtn);
            }
        }

        function toggleMapTheme() {
            const btn = document.getElementById('themeBtn');
            if (!isDarkMode) { map.removeLayer(lightTiles); darkTiles.addTo(map); btn.innerHTML = '<i class="fas fa-sun"></i> Light Mode'; isDarkMode = true; }
            else { map.removeLayer(darkTiles); lightTiles.addTo(map); btn.innerHTML = '<i class="fas fa-moon"></i> Dark Mode'; isDarkMode = false; }
            if(weatherLayer) weatherLayer.bringToFront();
        }

        function getLocation() { if (navigator.geolocation) { navigator.geolocation.getCurrentPosition((pos) => getWeatherByCoords(pos.coords.latitude, pos.coords.longitude)); } }
        async function getWeatherByCoords(lat, lon) { const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=th`); const data = await res.json(); updateUI(data); }
        async function getWeather() { const city = document.getElementById('cityInput').value; if(!city) return; const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${API_KEY}&units=metric&lang=th`); const data = await res.json(); if(data.cod === 200) updateUI(data); else alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡∏≠‡∏á"); }
        
        function updateUI(data) { 
            currentWeatherData = data; 
            document.getElementById('cityName').innerText = data.name; 
            document.getElementById('mainTemp').innerText = Math.round(data.main.temp) + '¬∞C'; 
            document.getElementById('description').innerText = data.weather[0].description; 
            document.getElementById('tempDetail').innerText = data.main.temp + ' ¬∞C'; 
            document.getElementById('humidity').innerText = data.main.humidity + '%'; 
            document.getElementById('wind').innerText = data.wind.speed + ' km/h'; 
            map.flyTo([data.coord.lat, data.coord.lon], 11); 
            L.marker([data.coord.lat, data.coord.lon]).addTo(map); 
        }

        // --- ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Logic ‡∏Å‡∏≤‡∏£ Toggle ‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° ---
        function toggleWeatherLayer(type, btn) {
            const descBox = document.getElementById('map-description');
            const descText = document.getElementById('desc-text');

            // 1. ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà -> ‡∏õ‡∏¥‡∏î‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå
            if (currentLayerType === type) {
                map.removeLayer(weatherLayer);
                weatherLayer = null;
                currentLayerType = null;
                btn.classList.remove('active-layer');
                descBox.classList.add('hidden');
                return;
            }

            // 2. ‡∏ñ‡πâ‡∏≤‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà -> ‡∏•‡∏ö‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏Å‡πà‡∏≠‡∏ô
            if (weatherLayer) map.removeLayer(weatherLayer);

            // 3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡πÉ‡∏´‡∏°‡πà
            weatherLayer = L.tileLayer(`https://tile.openweathermap.org/map/${type}/{z}/{x}/{y}.png?appid=${API_KEY}`, {
                opacity: 0.65, zIndex: 500
            }).addTo(map);
            currentLayerType = type;

            // 4. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° (Active ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå)
            document.querySelectorAll('.btn-weather-layer').forEach(b => b.classList.remove('active-layer'));
            btn.classList.add('active-layer');

            // 5. ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
            descBox.classList.remove('hidden');
            descText.innerHTML = layerDescs[type];
        }

        // --- SMART CHATBOT LOGIC ---
        function quickChat(text) { document.getElementById('chatInput').value = text; sendChat(); }
        function sendChat() {
            const input = document.getElementById('chatInput');
            const msg = input.value.trim();
            if (!msg) return;
            const box = document.getElementById('chat-messages');
            box.innerHTML += `<div class="user-msg p-2 px-3 bg-blue-600/30 rounded-2xl rounded-tr-none max-w-[85%] text-[11px] self-end">‡∏Ñ‡∏∏‡∏ì: ${msg}</div>`;
            input.value = '';
            
            const typingId = "typing-" + Date.now();
            box.innerHTML += `<div id="${typingId}" class="p-2 px-3 bg-white/5 rounded-2xl rounded-tl-none max-w-fit text-[10px] self-start typing italic">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå...</div>`;
            box.scrollTop = box.scrollHeight;

            setTimeout(() => {
                const typingEl = document.getElementById(typingId);
                if (typingEl) typingEl.remove();

                let reply = "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏•‡∏≠‡∏á‡∏ñ‡∏≤‡∏°‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á '‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ' ‡∏´‡∏£‡∏∑‡∏≠ '‡∏Å‡∏≤‡∏£‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß' ‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö";
                if (!currentWeatherData) {
                    reply = "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Å‡πà‡∏≠‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏£‡∏±‡∏ö";
                } else {
                    const temp = currentWeatherData.main.temp;
                    const cityName = currentWeatherData.name;
                    const weather = currentWeatherData.weather[0].main;
                    if (msg.includes('‡∏≠‡∏≤‡∏Å‡∏≤‡∏®')) reply = `‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡∏ó‡∏µ‡πà ${cityName} ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ ${Math.round(temp)}¬∞C ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Ñ‡∏∑‡∏≠ ${currentWeatherData.weather[0].description} ‡∏Ñ‡∏£‡∏±‡∏ö`;
                    else if (msg.includes('‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß')) reply = temp > 30 ? "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏£‡πâ‡∏≠‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î‡∏ú‡πâ‡∏≤‡∏ö‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö" : "‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏ö‡∏≤‡∏¢ ‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö";
                    else if (msg.includes('‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ')) reply = weather.includes('Rain') ? "‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ù‡∏ô‡∏ï‡∏Å ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡∏Ñ‡∏£‡∏±‡∏ö" : "‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡πÇ‡∏õ‡∏£‡πà‡∏á ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏ñ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö!";
                    else if (msg.includes('‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤')) reply = weather.includes('Rain') ? "‡∏ù‡∏ô‡∏à‡∏∞‡∏ï‡∏Å ‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö" : "‡∏ã‡∏±‡∏Å‡∏ú‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏î‡∏î‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏µ";
                }

                box.innerHTML += `<div class="ai-msg p-2 px-3 bg-white/10 rounded-2xl rounded-tl-none max-w-[85%] text-[11px] self-start">AI: ${reply}</div>`;
                box.scrollTop = box.scrollHeight;
            }, 1000);
        }

        function switchTab(tab) {
            document.getElementById('tab-map').classList.toggle('hidden', tab === 'chat');
            document.getElementById('tab-chat').classList.toggle('hidden', tab === 'map');
            // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î
            document.getElementById('btn-mode-map').className = tab === 'map' ? 'btn-mini active-mode font-semibold' : 'btn-mini font-semibold';
            document.getElementById('btn-mode-chat').className = tab === 'chat' ? 'btn-mini active-mode font-semibold' : 'btn-mini font-semibold';
        }

        window.onload = function() { getLocation(); checkLoginStatus(); };
    </script>
</body>
</html>